{"version":3,"sources":["../../../../assets/script/assets/script/start.js"],"names":["cc","Class","extends","Component","properties","draw","Graphics","player1","Node","base","hook","avatar","onLoad","wx","login","success","res","code","getSetting","authSetting","console","log","getUserInfo","userInfo","nickName","loader","load","url","avatarUrl","type","err","texture","error","find","getComponent","Sprite","spriteFrame","SpriteFrame","systemInfo","getSystemInfoSync","width","windowWidth","height","windowHeight","button","createUserInfoButton","text","style","left","top","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","onTap","getOpenDataContext","postMessage","message","score","hide","destroy","Global","sound","audioEngine","play","bgm","director","getCollisionManager","enabledDebugDraw","enabled","currentLevel","update","dt","clear","startPos","convertToWorldSpaceAR","v2","endPos","lineWidth","moveTo","x","y","lineTo","stroke"],"mappings":";;;;;;AACAA,GAAGC,KAAH,CAAS;AACPC,WAASF,GAAGG,SADL;;AAGPC,cAAY;AACVC,UAAML,GAAGM,QADC;AAEVC,aAASP,GAAGQ,IAFF;AAGVC,UAAMT,GAAGQ,IAHC;AAIVE,UAAMV,GAAGQ,IAJC;AAKVG,YAAQX,GAAGQ;AALD,GAHL;;AAWP;;AAEAI,QAbO,oBAaG;AACR,QAAI,OAAOC,EAAP,KAAc,WAAlB,EAA+B;AAC7B;AACD;;AAED;AACAA,OAAGC,KAAH,CAAS;AACPC,eAAQ,iBAASC,GAAT,EAAa;AACnB,YAAIC,OAAOD,IAAIC,IAAf;AACAJ,WAAGK,UAAH,CAAc;AACZH,iBADY,mBACHC,GADG,EACC;AACX,gBAAGA,IAAIG,WAAJ,CAAgB,gBAAhB,CAAH,EAAqC;AACnCC,sBAAQC,GAAR,CAAY,MAAZ;AACAR,iBAAGS,WAAH,CAAe;AACbP,yBAAS,iBAASC,GAAT,EAAa;AACpBI,0BAAQC,GAAR,CAAYL,IAAIO,QAAJ,CAAaC,QAAzB;AACAxB,qBAAGyB,MAAH,CAAUC,IAAV,CAAe,EAACC,KAAKX,IAAIO,QAAJ,CAAaK,SAAnB,EAA8BC,MAAM,KAApC,EAAf,EAA2D,UAACC,GAAD,EAAMC,OAAN,EAAkB;AAC3E,wBAAID,GAAJ,EAAS;AACLV,8BAAQY,KAAR,CAAcF,GAAd;AACA;AACH;AACD9B,uBAAGiC,IAAH,CAAQ,eAAR,EAAyBC,YAAzB,CAAsClC,GAAGmC,MAAzC,EAAiDC,WAAjD,GAA+D,IAAIpC,GAAGqC,WAAP,CAAmBN,OAAnB,CAA/D;AACD,mBAND;AAOD;AAVY,eAAf;AAYD,aAdD,MAcK;AACH,kBAAIO,aAAazB,GAAG0B,iBAAH,EAAjB;AACA,kBAAIC,QAAQF,WAAWG,WAAvB;AACA,kBAAIC,SAASJ,WAAWK,YAAxB;AACA,kBAAIC,SAAS/B,GAAGgC,oBAAH,CAAwB;AACjChB,sBAAM,MAD2B;AAEjCiB,sBAAM,gBAF2B;AAGjCC,uBAAO;AACHC,wBAAM,CADH;AAEHC,uBAAK,MAAIP,MAFN;AAGHF,yBAAOA,KAHJ;AAIHE,0BAAQA,MAJL;AAKHQ,8BAAY,EALT;AAMHC,mCAAiB,OANd;AAOHC,yBAAO,OAPJ;AAQHC,6BAAW,QARR;AASHC,4BAAU,EATP;AAUHC,gCAAc;AAVX;AAH0B,eAAxB,CAAb;;AAiBAX,qBAAOY,KAAP,CAAa,UAACxC,GAAD,EAAS;AAClB,oBAAIO,WAAWP,IAAIO,QAAnB;AACA,oBAAI,CAACA,QAAL,EAAe;AACX;AACH;AACHH,wBAAQC,GAAR,CAAYE,SAASC,QAArB;AACAxB,mBAAGyB,MAAH,CAAUC,IAAV,CAAe,EAACC,KAAKJ,SAASK,SAAf,EAA0BC,MAAM,KAAhC,EAAf,EAAuD,UAACC,GAAD,EAAMC,OAAN,EAAkB;AACnE,sBAAID,GAAJ,EAAS;AACLV,4BAAQY,KAAR,CAAcF,GAAd;AACA;AACH;AACD9B,qBAAGiC,IAAH,CAAQ,eAAR,EAAyBC,YAAzB,CAAsClC,GAAGmC,MAAzC,EAAiDC,WAAjD,GAA+D,IAAIpC,GAAGqC,WAAP,CAAmBN,OAAnB,CAA/D;AACD,iBANL;;AAQElB,mBAAG4C,kBAAH,GAAwBC,WAAxB,CAAoC;AAChCC,2BAAS;AADuB,iBAApC;AAGA9C,mBAAG6C,WAAH,CAAe;AACbC,2BAAQ,aADK;AAEbC,yBAAM;AAFO,iBAAf;AAIAhB,uBAAOiB,IAAP;AACAjB,uBAAOkB,OAAP;AACH,eAvBD;AAwBD;AACF;AA9DW,SAAd;AAgED;AAnEM,KAAT;;AAsEA,QAAGC,OAAOC,KAAP,KAAiB,CAApB,EAAsB;AACpBhE,SAAGiE,WAAH,CAAeC,IAAf,CAAoB,KAAKC,GAAzB,EAA8B,IAA9B,EAAoC,CAApC;AACD;AACDnE,OAAGoE,QAAH,CAAYC,mBAAZ,GAAkCC,gBAAlC,GAAqD,KAArD;AACAtE,OAAGoE,QAAH,CAAYC,mBAAZ,GAAkCE,OAAlC,GAA4C,IAA5C;AACAR,WAAOS,YAAP,GAAsB,CAAtB;AACD,GA/FM;AAiGPC,QAjGO,kBAiGCC,EAjGD,EAiGK;AACV,SAAKrE,IAAL,CAAUsE,KAAV;AACA,QAAMC,WAAW,KAAKnE,IAAL,CAAUoE,qBAAV,CAAgC7E,GAAG8E,EAAH,CAAM,CAAN,EAAS,CAAT,CAAhC,CAAjB;AACA,QAAMC,SAAS,KAAKrE,IAAL,CAAUmE,qBAAV,CAAgC7E,GAAG8E,EAAH,CAAM,CAAC,GAAP,EAAY,CAAC,IAAb,CAAhC,CAAf;AACA,SAAKzE,IAAL,CAAU2E,SAAV,GAAsB,GAAtB;AACA,SAAK3E,IAAL,CAAU4E,MAAV,CAAiBL,SAASM,CAA1B,EAA6BN,SAASO,CAAtC;AACA,SAAK9E,IAAL,CAAU+E,MAAV,CAAiBL,OAAOG,CAAxB,EAA2BH,OAAOI,CAAlC;AACA,SAAK9E,IAAL,CAAUgF,MAAV;AACD;AAzGM,CAAT","file":"start.js","sourceRoot":"../../../../assets/script","sourcesContent":["\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    draw: cc.Graphics,\n    player1: cc.Node,\n    base: cc.Node,\n    hook: cc.Node,\n    avatar: cc.Node,\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad () {\n    if (typeof wx === 'undefined') {\n      return;\n    }\n\n    //this.initUserInfoButton ()\n    wx.login({\n      success:function(res){\n        let code = res.code\n        wx.getSetting({\n          success (res){\n            if(res.authSetting['scope.userInfo']){\n              console.log(\"已经授权\")\n              wx.getUserInfo({\n                success: function(res){\n                  console.log(res.userInfo.nickName)\n                  cc.loader.load({url: res.userInfo.avatarUrl, type: 'png'}, (err, texture) => {\n                    if (err) {\n                        console.error(err);\n                        return;\n                    }\n                    cc.find('Canvas/avatar').getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture)\n                  });\n                }\n              })\n            }else{\n              let systemInfo = wx.getSystemInfoSync();\n              let width = systemInfo.windowWidth;\n              let height = systemInfo.windowHeight;\n              let button = wx.createUserInfoButton({\n                  type: 'text',\n                  text: 'Press to login',\n                  style: {\n                      left: 0,\n                      top: 0.4*height,\n                      width: width,\n                      height: height,\n                      lineHeight: 40,\n                      backgroundColor: 'white',\n                      color: 'black',\n                      textAlign: 'center',\n                      fontSize: 30,\n                      borderRadius: 4\n                  }\n              });\n          \n              button.onTap((res) => {\n                  let userInfo = res.userInfo;\n                  if (!userInfo) {\n                      return;\n                  }\n                console.log(userInfo.nickName);\n                cc.loader.load({url: userInfo.avatarUrl, type: 'png'}, (err, texture) => {\n                      if (err) {\n                          console.error(err);\n                          return;\n                      }\n                      cc.find('Canvas/avatar').getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture)\n                    });\n          \n                  wx.getOpenDataContext().postMessage({\n                      message: \"User info get success.\"\n                  });\n                  wx.postMessage({\n                    message:'UpdateScore',\n                    score:\"0\"\n                  })\n                  button.hide();\n                  button.destroy();\n              });            \n            }  \n          }\n        })\n      }\n    })\n\n    if(Global.sound === 1){\n      cc.audioEngine.play(this.bgm, true, 1)\n    }\n    cc.director.getCollisionManager().enabledDebugDraw = false\n    cc.director.getCollisionManager().enabled = true\n    Global.currentLevel = 1\n  },\n\n  update (dt) {\n    this.draw.clear()\n    const startPos = this.base.convertToWorldSpaceAR(cc.v2(0, 1))\n    const endPos = this.hook.convertToWorldSpaceAR(cc.v2(-0.1, -25.3))\n    this.draw.lineWidth = 4.5\n    this.draw.moveTo(startPos.x, startPos.y)\n    this.draw.lineTo(endPos.x, endPos.y)\n    this.draw.stroke()\n  }\n})\n"]}