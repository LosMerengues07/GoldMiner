{"version":3,"sources":["start.js"],"names":["cc","Class","extends","Component","properties","draw","Graphics","player1","Node","base","hook","avatar","onLoad","wx","login","success","res","getSetting","authSetting","console","log","getUserInfo","userInfo","nickName","loader","load","url","avatarUrl","type","err","texture","error","find","getComponent","Sprite","spriteFrame","SpriteFrame","systemInfo","getSystemInfoSync","width","windowWidth","height","windowHeight","button","createUserInfoButton","text","style","left","top","lineHeight","backgroundColor","color","textAlign","fontSize","borderRadius","onTap","getOpenDataContext","postMessage","message","score","hide","destroy","Global","currentLevel","currentMoney","fires","betterDiamonds","powers","luckys","stoneBooks","director","getCollisionManager","enabledDebugDraw","enabled","update","dt","clear","startPos","convertToWorldSpaceAR","v2","endPos","lineWidth","moveTo","x","y","lineTo","stroke"],"mappings":"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","file":"start.js","sourceRoot":"../../../../assets/script","sourcesContent":["\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    draw: cc.Graphics,\n    player1: cc.Node,\n    base: cc.Node,\n    hook: cc.Node,\n    avatar: cc.Node\n  },\n\n  // LIFE-CYCLE CALLBACKS:\n\n  onLoad () {\n    if (typeof wx === 'undefined') {\n      return\n    }\n\n    // this.initUserInfoButton ()\n    wx.login({\n      success: function (res) {\n        // const code = res.code\n        wx.getSetting({\n          success (res) {\n            if (res.authSetting['scope.userInfo']) {\n              console.log('已经授权')\n              wx.getUserInfo({\n                success: function (res) {\n                  console.log(res.userInfo.nickName)\n                  cc.loader.load({ url: res.userInfo.avatarUrl, type: 'png' }, (err, texture) => {\n                    if (err) {\n                      console.error(err)\n                      return\n                    }\n                    cc.find('Canvas/avatar').getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture)\n                  })\n                }\n              })\n            } else {\n              const systemInfo = wx.getSystemInfoSync()\n              const width = systemInfo.windowWidth\n              const height = systemInfo.windowHeight\n              const button = wx.createUserInfoButton({\n                type: 'text',\n                text: 'Press to login',\n                style: {\n                  left: 0,\n                  top: 0.4 * height,\n                  width: width,\n                  height: height,\n                  lineHeight: 40,\n                  backgroundColor: 'white',\n                  color: 'black',\n                  textAlign: 'center',\n                  fontSize: 30,\n                  borderRadius: 4\n                }\n              })\n\n              button.onTap((res) => {\n                const userInfo = res.userInfo\n                if (!userInfo) {\n                  return\n                }\n                console.log(userInfo.nickName)\n                cc.loader.load({ url: userInfo.avatarUrl, type: 'png' }, (err, texture) => {\n                  if (err) {\n                    console.error(err)\n                    return\n                  }\n                  cc.find('Canvas/avatar').getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture)\n                })\n\n                wx.getOpenDataContext().postMessage({\n                  message: 'User info get success.'\n                })\n                wx.postMessage({\n                  message: 'UpdateScore',\n                  score: '0'\n                })\n                button.hide()\n                button.destroy()\n              })\n            }\n          }\n        })\n      }\n    })\n\n    // if(Global.sound === 1){\n    //  cc.audioEngine.play(this.bgm, true, 1)\n    // }\n    Global.currentLevel = 1\n    Global.currentMoney = 0\n    Global.fires = 0\n    Global.betterDiamonds = 0\n    Global.powers = 0\n    Global.luckys = 0\n    Global.stoneBooks = 0\n    cc.director.getCollisionManager().enabledDebugDraw = false\n    cc.director.getCollisionManager().enabled = true\n  },\n\n  update (dt) {\n    this.draw.clear()\n    const startPos = this.base.convertToWorldSpaceAR(cc.v2(0, 1))\n    const endPos = this.hook.convertToWorldSpaceAR(cc.v2(-0.1, -25.3))\n    this.draw.lineWidth = 4.5\n    this.draw.moveTo(startPos.x, startPos.y)\n    this.draw.lineTo(endPos.x, endPos.y)\n    this.draw.stroke()\n  }\n})\n"]}